version: 2.1

jobs:
  cmake_test:
    resource_class: xlarge
    docker:
      - image: ubuntu:18.04
    steps:
      - checkout
      - run: ./ci/setup_ci_environment.sh
      - run: ./ci/setup_cmake.sh
      - run: ./ci/do_ci.sh cmake.test
      - store_artifacts:
          path: /build/Testing/Temporary/LastTest.log
          destination: Test.log

  gcc_48_test:
    resource_class: xlarge
    docker:
      - image: ubuntu:18.04
    steps:
      - checkout
      - run: ./ci/setup_ci_environment.sh
      - run: ./ci/install_bazelisk.sh
      - run: ./ci/install_gcc48.sh
      - run: CC=/usr/bin/g++-4.8 ./ci/do_ci.sh bazel.test

  bazel_test:
    resource_class: xlarge
    docker:
      - image: ubuntu:18.04
    steps:
      - checkout
      - run: ./ci/setup_ci_environment.sh
      - run: ./ci/install_bazelisk.sh
      - run: ./ci/do_ci.sh bazel.test


workflows:
  version: 2
  build_and_test:
    jobs:
      - cmake_test
      - gcc_48_test
      - bazel_test
