{#
  Copyright The OpenTelemetry Authors
  SPDX-License-Identifier: Apache-2.0

  This file is:
  - a Jinja template,
  - used to generate semantic conventions,
  - using weaver.

  For doc on the template syntax:
  https://jinja.palletsprojects.com/en/3.0.x/

  For doc on the semantic conventions:
  https://github.com/open-telemetry/semantic-conventions

  For doc on weaver:
  https://github.com/open-telemetry/weaver
#}
/*
 * Copyright The OpenTelemetry Authors
 * SPDX-License-Identifier: Apache-2.0
 */

/*
 * DO NOT EDIT, this is an Auto-generated file from:
 * buildscripts/semantic-convention/templates/registry/semantic_metrics-h.j2
 */
{# ========================================================================== #}

{% set debug = false %}

{% set file_name = ctx.output + (ctx.root_namespace | snake_case) ~ "_metrics.h" %}
{{ template.set_file_name(file_name) }}
{% import 'common.j2' as c %}

{% set metrics = ctx.metrics | list %}

{% macro metric_namespace(ctx) %}
{{ ctx.root_namespace | snake_case }}
{% endmacro %}

{% macro func_metric_name(metric) %}
{{ metric.id | pascal_case }}
{% endmacro %}

{% macro var_metric_name(metric) %}
k{{ metric.id | pascal_case }}
{% endmacro %}

{% macro descr_metric_name(metric) %}
descr{{ metric.id | pascal_case }}
{% endmacro %}

{% macro unit_metric_name(metric) %}
unit{{ metric.id | pascal_case }}
{% endmacro %}

{% macro sync_instrument_support(metric) %}
{{ metric.instrument | map_text("cpp_sync_support", "FIXME") }}
{% endmacro %}

{% macro sync_instrument_type(metric) %}
{{ metric.instrument | map_text("cpp_sync_instrument_to_type", "FIXME") }}
{% endmacro %}

{% macro sync_instrument_factory(metric) %}
{{ metric.instrument | map_text("cpp_sync_instrument_to_factory", "FIXME") }}
{% endmacro %}

{% macro async_instrument_support(metric) %}
{{ metric.instrument | map_text("cpp_async_support", "FIXME") }}
{% endmacro %}

{% macro async_instrument_type(metric) %}
{{ metric.instrument | map_text("cpp_async_instrument_to_type", "FIXME") }}
{% endmacro %}

{% macro async_instrument_factory(metric) %}
{{ metric.instrument | map_text("cpp_async_instrument_to_factory", "FIXME") }}
{% endmacro %}

{% set cpp_metric_namespace = metric_namespace(ctx) %}

{# ========================================================================== #}

#pragma once

#include "opentelemetry/common/macros.h"
#include "opentelemetry/version.h"

OPENTELEMETRY_BEGIN_NAMESPACE
namespace semconv
{
namespace {{ cpp_metric_namespace -}}
{

{% for metric in ctx.metrics %}
    {% if debug %}
// DEBUG: {{ metric }}
    {% endif %}
    {% set f_metric_name = func_metric_name(metric) %}
    {% set v_metric_name = var_metric_name(metric) %}
    {% set descr = descr_metric_name(metric) %}
    {% set unit = unit_metric_name(metric) %}
    {% set sync_support = sync_instrument_support(metric) %}
    {% set async_support = async_instrument_support(metric) %}
    {% set sync_type = sync_instrument_type(metric) %}
    {% set async_type = async_instrument_type(metric) %}
    {% set sync_factory = sync_instrument_factory(metric) %}
    {% set async_factory = async_instrument_factory(metric) %}
    {% set excluded = metric.id in ctx.excluded_attributes %}
    {% if excluded %}
#if 0
// Excluded metric:
    {% endif %}
    {% if metric is deprecated %}
{{ [metric.brief, "\n", "@deprecated", metric.deprecated, "\n", metric.note, "\n", metric.instrument] | comment(ident=2) }}
OPENTELEMETRY_DEPRECATED
    {% else %}
{{ [metric.brief, "\n", metric.note, "\n", metric.instrument] | comment(ident=2) }}
    {% endif %}
static constexpr const char *{{v_metric_name}} = "{{metric.id}}";
static constexpr const char *{{descr}} = "{{metric.brief}}";
static constexpr const char *{{unit}} = "{{metric.unit}}";

    {% if not sync_support %}
#if LATER
// Unsupported:
    {% endif %}
static nostd::unique_ptr<{{sync_type-}}<uint64_t>>
CreateSync{{f_metric_name-}}(metrics::Meter *meter)
{
  return meter->{{sync_factory}}(
    {{v_metric_name}},
    {{descr}},
    {{unit}});
}
    {% if not sync_support %}
#endif
    {% endif %}

    {% if not async_support %}
#if LATER
// Unsupported:
    {% endif %}
static nostd::shared_ptr<{{async_type-}}>
CreateAsync{{f_metric_name-}}(metrics::Meter *meter)
{
  return meter->{{async_factory}}(
    {{v_metric_name}},
    {{descr}},
    {{unit}});
}
    {% if not async_support %}
#endif
    {% endif %}

    {% if excluded %}
#endif
    {% endif %}

{% endfor %}

}
}
OPENTELEMETRY_END_NAMESPACE

